#!/usr/bin/env bash
set -euo pipefail

if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" || "$OSTYPE" == "cygwin" ]]; then
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../scripts" && pwd)"
    POWERSHELL_SCRIPT="$SCRIPT_DIR/pre-commit-build.ps1"

    if [[ -f "$POWERSHELL_SCRIPT" ]]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫ PowerShell pre-commit —Å–∫—Ä–∏–ø—Ç–∞..."
        powershell.exe -ExecutionPolicy Bypass -File "$POWERSHELL_SCRIPT"
        exit $?
    else
        echo "‚ö†Ô∏è PowerShell —Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: $POWERSHELL_SCRIPT"
    fi
fi

if command -v dart >/dev/null 2>&1; then
  echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (dart format)..."
  dart format --output=none --set-exit-if-changed .
  echo "üîç –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (flutter/dart analyze)..."
  if command -v flutter >/dev/null 2>&1; then
    flutter analyze
  else
    dart analyze
  fi
else
  echo "‚ö†Ô∏è Dart/Flutter –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–ø—É—Å–∫–∞—é –ø—Ä–æ–≤–µ—Ä–∫–∏."
fi

echo "‚úÖ pre-commit –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ"
